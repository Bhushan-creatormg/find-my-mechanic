<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find My Mechanic</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .container {
            display: none;
        }
        .auth-container {
            display: flex;
            flex-direction: column;
            max-width: 300px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
        input, button {
            margin-top: 10px;
            padding: 10px;
            width: 100%;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        .logout {
            background-color: red;
        }
    </style>
</head>
<body>

    <!-- Sign-up/Login Form -->
    <div id="auth" class="auth-container">
        <h2>Login / Sign Up</h2>
        <input type="text" id="name" placeholder="Full Name">
        <input type="email" id="email" placeholder="Email">
        <input type="tel" id="phone" placeholder="Phone Number">
        <input type="password" id="password" placeholder="Password">
        <button onclick="signup()">Sign Up / Login</button>
    </div>

    <!-- Main Content (Hidden until login) -->
    <div id="mainContent" class="container">
        <h1>Find My Mechanic</h1>
        <p>Get Quotes & Compare prices to find the best mechanic near you!</p>
        <button class="logout" onclick="logout()">Logout</button>

        <h2>Available Mechanics</h2>

        <!-- Search & Filter -->
        <input type="text" id="searchBox" onkeyup="searchMechanics()" placeholder="Search by name or location...">
        <button onclick="fetchMechanics()">Refresh</button>

        <table id="mechanicTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Location</th>
                    <th>Vehicle</th>
                    <th>Company</th>
                    <th>Model</th>
                    <th>Service</th>
                    <th>Price</th>
                    <th>Contact</th>
                </tr>
            </thead>
            <tbody id="mechanicTableBody">
                <!-- Data will be loaded here -->
            </tbody>
        </table>

        <h2>Are You a Mechanic?</h2>
        <p>List your services on our platform and get customers easily!</p>
        <a href="https://docs.google.com/forms/d/e/1FAIpQLSdBB9gADvYhi5VAhyGfufia13uAbzQSD_xksyzo69FSZTLzEQ/viewform?usp=pp_url">
            <button>Register as Mechanic</button>
        </a>
    </div>

    <script>
        // Check if user is already logged in
        function checkLogin() {
            const user = localStorage.getItem("user");
            if (user) {
                document.getElementById("auth").style.display = "none";
                document.getElementById("mainContent").style.display = "block";
                fetchMechanics();
            }
        }

        // Sign-up/Login Function
        function signup() {
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;
            const password = document.getElementById("password").value;

            if (!name || !email || !phone || !password) {
                alert("Please fill in all fields!");
                return;
            }

            // Store user in local storage
            localStorage.setItem("user", JSON.stringify({ name, email, phone }));
            alert("Login Successful!");
            checkLogin();
        }

        // Logout Function
        function logout() {
            localStorage.removeItem("user");
            location.reload();
        }

        // Fetch Mechanics Data
        function fetchMechanics() {
            fetch("https://script.google.com/macros/s/AKfycbxYC-hUzcufX8cO8d3IOVLoYt_-bhNwKUdhWNUYI3ujp_ZiELeusMAn-Zcafabni2XyHA/exec")
                .then(response => response.json())
                .then(data => {
                    updateTable(data);
                })
                .catch(error => console.error("Error fetching data:", error));
        }

        function updateTable(mechanics) {
            let mechanicTableBody = document.getElementById("mechanicTableBody");
            mechanicTableBody.innerHTML = "";

            if (mechanics.length === 0) {
                mechanicTableBody.innerHTML = "<tr><td colspan='8'>No mechanics found.</td></tr>";
                return;
            }

            mechanics.forEach(mechanic => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${mechanic.name}</td>
                    <td>${mechanic.location}</td>
                    <td>${mechanic.vehicle}</td>
                    <td>${mechanic.company}</td>
                    <td>${mechanic.model}</td>
                    <td>${mechanic.service}</td>
                    <td>â‚¹${mechanic.price}</td>
                    <td>${mechanic.contact}</td>
                `;
                mechanicTableBody.appendChild(row);
            });
        }

        // Search Function
        function searchMechanics() {
            let input = document.getElementById("searchBox").value.toLowerCase();
            let rows = document.querySelectorAll("#mechanicTableBody tr");

            rows.forEach(row => {
                let name = row.cells[0].innerText.toLowerCase();
                let location = row.cells[1].innerText.toLowerCase();
                row.style.display = (name.includes(input) || location.includes(input)) ? "" : "none";
            });
        }

        checkLogin(); // Run on page load
    </script>

</body>
</html>
